jQuery(document).ready(function(a){"use strict";var b={listID:"#wpglobus-sortable",customizeSave:!1,customizeSaveData:"",init:function(){a("#wpglobus-sortable").sortable({update:b.sortUpdate}),b.addListeners(),b.ajaxListener()},addListeners:function(){a("body").on("change",".wpglobus-listen-change",function(a){b.setState(!1)}),a("body").on("change","#wpglobus-sortable input.wpglobus-language-item",function(c){var d=a(this);d.prop("checked")||b.removeLanguage(d)}),a("#customize-control-wpglobus_add_languages_select_box select").on("change",function(a){b.addLanguage(a,this)}),a("#accordion-section-"+WPGlobusCustomizeOptions.sections.wpglobus_addons_section+" .accordion-section-title").off("click keydown"),a("body").on("click","#accordion-section-"+WPGlobusCustomizeOptions.sections.wpglobus_addons_section+" .accordion-section-title",function(a){window.open(WPGlobusCustomizeOptions.addonsPage,"_blank")}),a(document).on("click","#"+WPGlobusCustomizeOptions.userControlSaveButton,function(){b.userControlAjax(this)})},removeLanguage:function(b){var c=b.data("language"),d=a("#customize-control-wpglobus_add_languages_select_box select option").eq(0);a('<option value="'+c+'">'+WPGlobusCustomizeOptions.config.language_name[c]+" ("+WPGlobusCustomizeOptions.config.en_language_name[c]+") </option>").insertAfter(d),b.parent("li").remove()},addLanguage:function(c,d){var e=a(d).attr("value"),f=a("#wpglobus-item-skeleton").html(),g="",h=a(b.listID+" li").attr("class");if("select"!=e){g=f.replace("{{flag}}",'src="'+WPGlobusCustomizeOptions.config.flags_url+WPGlobusCustomizeOptions.config.flag[e]+'"'),g=g.replace("{{name}}",e),g=g.replace("{{id}}",e),g=g.replace('checked="{{checked}}"','checked="checked"'),g=g.replace('disabled="{{disabled}}"',""),g=g.replace("{{item}}",WPGlobusCustomizeOptions.config.en_language_name[e]+" ("+e+") "),g=g.replace("{{order}}","#"),g=g.replace("{{language}}",e),g=g.replace("{{edit-link}}",WPGlobusCustomizeOptions.editLink.replace("{{language}}",e)),a('<li class="'+h+'">'+g+"</li>").appendTo(b.listID),b.setOrder();var i=a(d).find("option");a.each(i,function(b,c){a(c).attr("value")==e&&a(c).remove()})}},sortUpdate:function(a,c){b.setState(!1),b.setOrder()},setOrder:function(){a("#wpglobus-sortable input.wpglobus-language-item").each(function(b,c){var d=a(c);0==b?d.prop("disabled","disabled").prop("checked","checked"):d.removeProp("disabled"),d.data("order",b)})},setState:function(a){wp.customize.state("saved").set(a)},getCustomizeSaveData:function(){return b.customizeSaveData},enabledUserControl:function(a){return void 0!==WPGlobusCustomize.controlInstances[a]&&WPGlobusCustomize.controlInstances[a].userControl.enabled},userControlAjax:function(b){a(b).prop("disabled",!0);var c={};c.action="cb-controls-save",c.controls={},a(".wpglobus-customize-cb-control").each(function(b,d){var e=a(d);if(e.prop("checked"));else{var f=e.data("control");f=f.replace("[","{{"),f=f.replace("]","}}"),c.controls[f]="disable"}}),a.ajax({beforeSend:function(){},type:"POST",url:WPGlobusCustomizeOptions.ajaxurl,data:{action:WPGlobusCustomizeOptions.process_ajax,order:c},dataType:"json"}).always(function(){location.reload(!0)})},ajax:function(c,d){if("wpglobus_customize_save"==c){var e={};e.action="wpglobus_customize_save",e.options={},a.each(WPGlobusCustomizeOptions.settings,function(c,d){a.each(d,function(c,d){if("wpglobus_customize_enabled_languages"==c)return e.options[d.option]={},a("#wpglobus-sortable input.wpglobus-language-item").each(function(b,c){e.options[d.option][a(this).data("language")]="1"}),!0;if(-1!=b.customizeSaveData.indexOf("wpglobus_customize_post_type_")&&-1!=c.indexOf("wpglobus_customize_post_type_"))void 0===e.options[d.option]&&(e.options[d.option]={}),e.options[d.option][c.replace("wpglobus_customize_post_type_","")]=a("#customize-control-"+c+" input").prop("checked")?1:0;else if(-1!=b.customizeSaveData.indexOf(c)){var f=a("#customize-control-"+c+" "+d.type),g="";"textarea"==d.type?g=f.val():"wpglobus_checkbox"==d.type?(f=a("#customize-control-"+c+" input"),g="wpglobus_customize_selector_wp_list_pages"==c?f.prop("checked")?1:0:f.prop("checked")?1:""):"checkbox"==d.type?g=f.prop("checked")?1:"":"select"==d.type&&(g=f.val()),e.options[d.option]=g}})})}a.ajax({beforeSend:function(){},type:"POST",url:WPGlobusCustomizeOptions.ajaxurl,data:{action:WPGlobusCustomizeOptions.process_ajax,order:e},dataType:"json"})},getChangesetData:function(b){if(void 0!==b){var c=/customize_changeset_data=([^&]+)/.exec(b);if(void 0===c[1])return;var d,e=decodeURIComponent(c[1]),f=JSON.parse(e);a.each(f,function(a,b){void 0!==WPGlobusCustomize.controlInstances[a]&&(d="",d=(WPGlobusCustomize.controlInstances[a].type,WPGlobusCustomize.controlInstances[a].setting),f[a].value=d)});var g=JSON.stringify(f);g=encodeURIComponent(g),g=g.replace(/%20/g,"+"),b=b.replace(c[1],g)}return b},ajaxListener:function(){a(document).on("ajaxSend",function(a,c,d){void 0!==d.data&&-1!=d.data.indexOf("wp_customize=on")&&-1!=d.data.indexOf("action=customize_save")&&(-1!=d.data.indexOf("customized=")?(b.customizeSave=!0,b.customizeSaveData=d.data):-1!=d.data.indexOf("customize_changeset_data=")&&(d.data=b.getChangesetData(d.data)))}),a(document).on("ajaxComplete",function(a,c,d){void 0!==c.responseText&&b.customizeSave&&(b.customizeSave=!1,b.ajax("wpglobus_customize_save"))}),a(document).on("ajaxStop",function(){b.customizeSave&&(b.customizeSave=!1,b.ajax("wpglobus_customize_save"))})}};WPGlobusCustomizeOptions=a.extend({},WPGlobusCustomizeOptions,b),WPGlobusCustomizeOptions.init()});