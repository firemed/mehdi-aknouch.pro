jQuery(document).ready(function(a){"use strict";var b={languages:{},index:0,length:0,controlInstances:{},controlWidgets:{},instancesKeep:!1,widgetKeep:!1,action:!1,customizeSave:!1,selectorHtml:'<span style="margin-left:5px;" class="wpglobus-icon-globe"></span><span style="font-weight:bold;">{{language}}</span>',settingsSectionExpand:function(){a(document).triggerHandler("wpglobus_fields_settings_section_expand",[this,b])},init:function(c){b.setTitle(),"false"!=WPGlobusCustomizeOptions.themeEnabled&&(a.each(WPGlobusCoreData.enabled_languages,function(a,c){b.languages[a]=c,b.length=a}),b.addLanguageSelector(),b.setControlInstances(),b.setFieldsSection(),b.attachListeners())},getSize:function(a){return void 0===a?_.size(b.controlInstances):"widget"==a?_.size(b.controlWidgets):null},setFieldsSection:function(){var c={},d=a(".wpglobus-fields_settings_control_box").data("section-template"),e="",f="",g="";a.each(WPGlobusCustomize.controlInstances,function(a,b){void 0===c[b.section]&&(c[b.section]={}),c[b.section][a]=b}),a.each(c,function(b,c){if(f="<ul>",a.each(c,function(a,b){g=b.userControl.enabled?" checked ":"",f+='<li id="'+b.fieldSettings.itemID+'">',f+='<input id="'+b.fieldSettings.cbID+'" data-control="'+a+'" class="wpglobus-customize-cb-control" type="checkbox"'+g+' /> <span class="wpglobus-cb-control-title">'+b.title+"</span>",f+="</li>"}),f+="</ul>",void 0===wp.customize.section(b))return!0;e=d.replace("{{section_title}}",wp.customize.section(b).params.title),e=e.replace(/{{section}}/g,b),e=e.replace("{{section_id}}",'"'+b+'"'),e=e.replace("{{items}}",f),a(e).insertBefore(a("#"+WPGlobusCustomizeOptions.userControlSaveButton))}),a("#accordion-section-wpglobus_fields_settings_section").css({"margin-top":"15px"}),a(WPGlobusCustomizeOptions.helpButton).insertAfter(a("#accordion-section-wpglobus_fields_settings_section .customize-action")),a("#accordion-section-wpglobus_fields_settings_section .customize-section-description").addClass("hidden"),a(document).on("click","."+WPGlobusCustomizeOptions.userControlIconClass,function(c){var d=a(this).data("section");a(WPGlobusCustomizeOptions.userControlBoxSelector).each(function(b,c){d==a(c).data("section")?a(this).css({display:"block"}):a(this).css({display:"none"})}),wp.customize.control("wpglobus_fields_settings_section").expand({completeCallback:b.settingsSectionExpand})}),a(".wpglobus-customize-icon-help.customize-help-toggle").on("click",function(b){a("#accordion-section-wpglobus_fields_settings_section .customize-section-description").toggleClass("hidden")})},setUserControls:function(b,c){var d=c.controlSelector+" "+c.selector,e='<img class="'+WPGlobusCustomizeOptions.userControlIconClass+'" data-section="'+c.section+'" style="position:absolute;right:0px;cursor:pointer;" src="'+WPGlobusCustomizeOptions.userControlIcon+'" />';a(e).insertBefore(d),c.userControl.enabled||(a(d).length>1?a(d).each(function(b,c){a(c).removeClass(WPGlobusCustomize.controlClass)}):a(d).removeClass(WPGlobusCustomize.controlClass).val(c.setting))},ctrlMenuItemsCallback:function(a,b){},ctrlWidgetCallback:function(c,d){if(b.action=!1,void 0===b.controlWidgets[c].element){void 0===d&&(d=wp.customize.control.instance(c)),b.controlWidgets[c].element={},b.controlWidgets[c].control=d,b.controlWidgets[c].inWidgetTitle=d.container.find(".in-widget-title"),b.controlWidgets[c].parent=d.selector;var e=d.container.find("input[type=submit]");0!=e.length&&(e.css({display:"block"}),e.attr("data-widget",c),b.controlWidgets[c].submit=e,b.attachWidgetListeners(b.controlWidgets[c])),d.liveUpdateMode=!1,void 0===d.setting().title?b.controlWidgets[c].inWidgetTitle.text(""):b.controlWidgets[c].inWidgetTitle.text(": "+WPGlobusCore.TextFilter(d.setting().title,WPGlobusCustomize.languageAdmin)),a.each(WPGlobusCustomize.elementSelector,function(e,f){var g=d.container.find(f);0!=g.length&&a.each(g,function(e,h){if(void 0===h.id||""==h.id)return!0;var i=a(g[e]);void 0===b.controlWidgets[c].element[h.id]&&(b.controlWidgets[c].element[h.id]={}),i.addClass("wpglobus-customize-widget-control"),i.attr("data-widget",c),b.controlWidgets[c].element[h.id].element=i,b.controlWidgets[c].element[h.id].setting=d.setting(),b.controlWidgets[c].element[h.id].selector=f,b.controlWidgets[c].element[h.id].value=h.defaultValue,i.val(WPGlobusCore.TextFilter(h.defaultValue,WPGlobusCoreData.language,"RETURN_EMPTY"))})}),a(document).triggerHandler("wpglobus_customize_control_added_widget",[c])}},ctrlCallback:function(c,d,e){var f=!1;if(a.each(WPGlobusCustomize.disabledSections,function(a,b){if(c.section()==b)return f=!0,!1}),!f&&(a.each(WPGlobusCustomize.disabledSettingMask,function(a,b){if(d.indexOf(b)>=0)return f=!0,!1}),!f)){var g=wp.customize.control.instance(d);if(d.indexOf("widget")>=0)return void 0===b.controlWidgets[d]&&(b.controlWidgets[d]={},b.action&&b.ctrlWidgetCallback(d,g)),b.controlWidgets[d].parent=g.selector,b.controlWidgets[d].observer=new MutationObserver(function(a){a.forEach(function(a){"class"==a.attributeName&&-1!=a.target.className.indexOf("expanding")&&b.ctrlWidgetCallback(d)})}),b.controlWidgets[d].observer.observe(document.querySelector(b.controlWidgets[d].parent),{attributes:!0,childList:!0,characterData:!0}),!1;if(void 0===b.controlInstances[d]){var h=!0;a.each(WPGlobusCustomize.elementSelector,function(c,e){var f=g.container.find(e);0!=f.length&&(b.controlInstances[d]={},b.controlInstances[d].element=f,b.controlInstances[d].elementID=f.attr("id")?"#"+f.attr("id"):void 0,b.controlInstances[d].setting=g.setting(),b.controlInstances[d].selector=e,b.controlInstances[d].controlSelector=g.selector,b.controlInstances[d].type="",b.controlInstances[d].section=g.section(),b.controlInstances[d].title=null,b.controlInstances[d].userControl=null,b.controlInstances[d].fieldSettings={},b.controlInstances[d].fieldSettings.itemID="item-wpglobus-cb-control-"+WPGlobusDialogApp.convertToId(d),b.controlInstances[d].fieldSettings.cbID="wpglobus-cb-control-"+WPGlobusDialogApp.convertToId(d),a.each(WPGlobusCustomize.setLinkBy,function(c,e){if(d.indexOf(e)>=0){if(b.controlInstances[d].type="link",""==b.controlInstances[d].setting&&(b.controlInstances[d].setting=f[0].defaultValue),WPGlobusCustomize.changeset_uuid){var g=wp.customize.control(d).setting();if(-1!==g.indexOf("|||")){var h=b.getTranslations(g);wp.customize.control(d).setting(h[WPGlobusCoreData.default_language]),a(WPGlobusCustomize.controlInstances[d].controlSelector+" "+WPGlobusCustomize.controlInstances[d].selector).val(h[WPGlobusCoreData.default_language])}}f.addClass("wpglobus-control-link")}}),""===b.controlInstances[d].type&&(b.controlInstances[d].type="textarea"==e?"textarea":"text"),f.val(WPGlobusCore.TextFilter(b.controlInstances[d].setting,WPGlobusCoreData.language,"RETURN_EMPTY")),f.addClass("wpglobus-customize-control"),f.attr("data-wpglobus-customize-control",b.controlInstances[d].controlSelector.replace("#customize-control-","")),"link"==b.controlInstances[d].type&&(b.controlInstances[d].setting=b.convertString(f[0].defaultValue)),b.controlInstances[d].title=g.params.label,null!==WPGlobusCustomizeOptions.userControl&&void 0!==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName]&&void 0!==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName][d]&&"disable"==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName][d]&&(h=!1),b.controlInstances[d].userControl={},b.controlInstances[d].userControl.enabled=h,b.setUserControls(d,b.controlInstances[d]))})}}},setControlInstances:function(){wp.customize.control.each(b.ctrlCallback)},setTitle:function(){a(WPGlobusCoreData.customize.info.element).html(WPGlobusCoreData.customize.info.html)},convertString:function(b){if(void 0===b)return b;var c=[],d=WPGlobusCore.getTranslations(b),e=0,f=!0;return b==d[WPGlobusCoreData.default_language]?b:(a.each(d,function(a,b){""==b?c[e]="null":(f=!1,c[e]=b),e++}),f?"":c.join("|||"))},getTranslations:function(b){if(void 0===b)return b;var c={},d=b.split("|||");return a.each(WPGlobusCoreData.enabled_languages,function(a,b){c[b]=void 0===d[a]||"null"===d[a]?"":d[a]}),c},getString:function(c,d,e){if(void 0===c)return c;void 0===d&&(d=""),void 0===e&&(e=WPGlobusCoreData.language);var f=b.getTranslations(c),g=[],h=0,i=!0;return a.each(f,function(a,b){a==e?(d=d.trim(),g[h]=""==d?"null":d):g[h]=""==b?"null":b,a!=WPGlobusCoreData.default_language&&"null"!=g[h]&&(i=!1),h++}),g=i?g[0]:g.join("|||")},addLanguageSelector:function(){a(WPGlobusCustomize.selectorButton).insertAfter(".customize-controls-preview-toggle"),a(".wpglobus-customize-selector").html(b.selectorHtml.replace("{{language}}",WPGlobusCoreData.language)),a(document).on("click",".wpglobus-customize-selector",function(c){b.index>b.length-1?b.index=0:b.index++,WPGlobusCoreData.language=b.languages[b.index],a(this).html(b.selectorHtml.replace("{{language}}",WPGlobusCoreData.language)),a(document).triggerHandler("wpglobus_customize_control_language",[WPGlobusCoreData.language]),a(".wpglobus-customize-control").each(function(c,d){var e=a(d),f=e.data("customize-setting-link");if(void 0!==WPGlobusCustomize.controlInstances[f]||(f=e.data("wpglobus-customize-control"),void 0!==WPGlobusCustomize.controlInstances[f]))if(e.hasClass("wpglobus-control-link")){var g=b.getTranslations(WPGlobusCustomize.controlInstances[f].setting);e.val(g[WPGlobusCoreData.language])}else e.val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[f].setting,WPGlobusCoreData.language,"RETURN_EMPTY"))}),a(".wpglobus-customize-widget-control").each(function(b,c){var d=a(c),e=d.data("widget");if(void 0===d.attr("id"))return!0;d.val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[e].element[d.attr("id")].value,WPGlobusCoreData.language,"RETURN_EMPTY"))})})},updateElements:function(c){void 0===c&&(c=!0),a.each(WPGlobusCustomize.controlInstances,function(a,d){if(!d.userControl.enabled)return!0;var e=wp.customize.control.instance(a);if("link"==d.type){var f=b.getTranslations(WPGlobusCustomize.controlInstances[a].setting);c?(e.setting.set(f[WPGlobusCoreData.language]),d.element.val(e.setting())):d.element.val(f[WPGlobusCoreData.language])}else c?(e.setting.set(WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[a].setting,WPGlobusCoreData.language,"RETURN_EMPTY")),d.element.val(e.setting())):d.element.val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[a].setting,WPGlobusCoreData.language,"RETURN_EMPTY"))})},onSubmitEvents:function(c){"mouseenter"==c.type?a.each(b.controlWidgets[a(this).data("widget")].element,function(b,c){a("#"+b).val(c.value)}):"mouseleave"==c.type?b.widgetKeep||a.each(b.controlWidgets[a(this).data("widget")].element,function(b,c){a("#"+b).val(WPGlobusCore.TextFilter(c.value,WPGlobusCoreData.language,"RETURN_EMPTY"))}):"click"==c.type&&(b.widgetKeep=!0)},attachWidgetListeners:function(c){void 0!==c.submit[0].id&&a(document).on("mouseenter","#"+c.submit[0].id,b.onSubmitEvents).on("mouseleave","#"+c.submit[0].id,b.onSubmitEvents).on("click","#"+c.submit[0].id,b.onSubmitEvents)},attachListeners:function(){a(".wpglobus-customize-control").on("keyup",function(c){var d=a(this),e=d.data("customize-setting-link");void 0===WPGlobusCustomize.controlInstances[e]&&(e=d.data("wpglobus-customize-control"),WPGlobusCustomize.controlInstances[e]),void 0===a(document).triggerHandler("wpglobus_customize_control_keyup",[d,e])&&("link"==WPGlobusCustomize.controlInstances[e].type?WPGlobusCustomize.controlInstances[e].setting=b.getString(WPGlobusCustomize.controlInstances[e].setting,d.val(),WPGlobusCoreData.language):WPGlobusCustomize.controlInstances[e].setting=WPGlobusCore.getString(WPGlobusCustomize.controlInstances[e].setting,d.val(),WPGlobusCoreData.language))}),a(document).on("keyup",".wpglobus-customize-widget-control",function(b){var c=a(this),d=c.data("widget");void 0!==WPGlobusCustomize.controlWidgets[d]&&(WPGlobusCustomize.controlWidgets[d].element[c.attr("id")].value=WPGlobusCore.getString(WPGlobusCustomize.controlWidgets[d].element[c.attr("id")].value,c.val(),WPGlobusCoreData.language))}),a(document).on("mouseenter","#save",function(b){a.each(WPGlobusCustomize.controlInstances,function(a,b){if(b.userControl.enabled){var c=wp.customize.control.instance(a);c.setting.set(b.setting),b.element.val(c.setting())}})}).on("mouseleave","#save",function(a){b.instancesKeep||b.updateElements()}),a("#save").on("click",function(a){b.instancesKeep=!0}),a(document).on("ajaxSend",function(a,c,d){void 0!==d.data&&-1!=d.data.indexOf("wp_customize=on")&&-1!=d.data.indexOf("action=customize_save")&&(b.customizeSave=!0)}),a(document).on("ajaxComplete",function(c,d){void 0!==d.responseText&&(b.customizeSave?(b.updateElements(!1),b.instancesKeep&&(b.instancesKeep=!1)):(d.responseText.indexOf("WP_CUSTOMIZER_SIGNATURE")>=0&&(b.action="customizerAjaxComplete",b.setControlInstances()),a.each(WPGlobusCustomize.controlWidgets,function(c,e){var f=c.replace("_","-");if(d.responseText.indexOf(f)>=0)return e.submit.css({display:"block"}),e.control.liveUpdateMode=!1,a.each(e.element,function(b,c){a("#"+b).val(WPGlobusCore.TextFilter(c.value,WPGlobusCoreData.language,"RETURN_EMPTY"))}),e.inWidgetTitle.text(": "+WPGlobusCore.TextFilter(e.control.setting().title,WPGlobusCustomize.languageAdmin)),b.widgetKeep=!1,!1})),b.customizeSave=!1)})}};WPGlobusCustomize=a.extend({},WPGlobusCustomize,b),WPGlobusCustomize.init()});